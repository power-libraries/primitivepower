language: java
jdk:
  - oraclejdk8
cache:
  directories:
    - '$HOME/.m2/repository'
jobs:
  include:
    - stage: "build & test"
      name: "Test if generated code matches templates"
      script:
        - mkdir tmp
        - cd primitivepower-generator
        - mvn -B -V install -DskipTests
        - mvn -B -V test
        - mvn exec:java -DskipTests -Dexec.args="../tmp/"
        - cd ..
        - diff -qrN -x '*.class' tmp/ primitivepower/
    - name: "Tests"
      install:
        - cd primitivepower
        - mvn -B -V install -DskipTests
      script:
        - mvn -B -V test